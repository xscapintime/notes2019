> ![](https://upload-images.jianshu.io/upload_images/14383117-bb1c86f9d7728a8b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



äº‹æƒ…èµ·æºäºï¼ŒæŸä¸ª~~åƒäº†å¾ˆå¤šæ±‰å ¡ç‹~~ä¸€èµ·å­¦ä¹ çš„æ—¥å­ï¼ŒæŠ€èƒ½æ ‘ä¸€ä¼—å­¦å¾’ä¸€èµ·å­¦ä¹ ä»GEOæ•°æ®æŒ–æ˜åˆ°`limma`å·®å¼‚åˆ†æç­‰ç­‰ç­‰ã€‚

é€‰çš„æ•°æ®é›†å€’æ˜¯å¾ˆæœ‰ã€è¶£ã€‚éšä¾¿ç”»çš„çƒ­å›¾æ˜¯è¿™æ ·çš„ğŸ‘‡ï¼ˆå·²ç»å¾ˆæ•´é½å‡ä¸€äº†

![](https://upload-images.jianshu.io/upload_images/14383117-875bc275519222fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

`t(scale(t(x)))` å½’ä¸€åŒ–åï¼Œç”»å‡ºæ¥æ˜¯è¿™æ ·çš„ğŸ‘‡ ï¼ˆå·²ç»ç¾çš„ä¸çœŸå®äº†

![](https://upload-images.jianshu.io/upload_images/14383117-4e205d7fee24e290.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è€Œä¸”å‘¢ï¼ŒlogFCä¹Ÿé«˜åˆ°æƒŠäºº

```r
checkFC <- fivenum(DEGdf$logFC)
checkFC
# [1] -13.4823993  -0.5407014   0.1940622   0.6915652  13.0133092
```

æ‰€ä»¥å…¶å®è¿™ä¸ªè¡¨è¾¾çŸ©é˜µæ˜¯**å·²ç»å½’ä¸€åŒ–è¿‡**çš„ã€‚

ä¸ºäº†æ¢ç©¶äº‹ç‰©çš„æœ¬è´¨å’Œå®‡å®™å¥¥ä¹‰ï¼Œæ‹¿ä¸€ä¸ªä¼˜ç§€çš„ã€è¡¨ç°æ— å¼‚å¸¸çš„æ•°æ®é›†ï¼Œåˆ†åˆ«æ±‚ç”±**åŸå§‹çŸ©é˜µ**å¾—å‡ºçš„logFC, å’Œç”±**å½’ä¸€åŒ–çŸ©é˜µ**çš„logFC, çœ‹çœ‹**æ™®é€šFC**å’Œ**è¯¡å¼‚FC**ä¹‹é—´å­˜ä¸å­˜åœ¨è§„å¾‹/çº¿æ€§å…³ç³»ã€‚

---

## ç”¨æ¥åæ¨çš„æ•°æ®é›†

GSE12452 

##  å¸¸è§„æ“ä½œ

#### GEOæ•°æ®ä¸‹è½½

```r
gset<- getGEO('GSE12452', destdir=".",
              AnnotGPL = F,   
              getGPL = F) 
```

#### è·å¾—è¡¨è¾¾çŸ©é˜µåŠåˆ†ç»„ä¿¡æ¯

```R
eset <- gset[[1]]
expmat <- exprs(eset)
pd <- pData(eset)
group_list <- ifelse(grepl('normal',pd$title),'normal','npc')
```

#### limmaå·®å¼‚åˆ†æ

```R
library(limma)
design <- model.matrix(~0+factor(group_list))
colnames(design) <- levels(factor(group_list))
rownames(design) <- colnames(expmat)
contrast.matrix<-makeContrasts("npc-normal",levels = design)
contrast.matrix
#         Contrasts
# Levels   npc-normal
#   normal         -1
#   npc             1
```

jimmyå¤§ç¥æŠŠæ‹Ÿåˆè¿‡ç¨‹åŒ…åœ¨äº†ä¸€ä¸ªå‡½æ•°é‡Œï¼š

```R
deg = function(expmat,design,contrast.matrix){
  ##step1
  fit <- lmFit(expmat,design)
  ##step2
  fit2 <- contrasts.fit(fit, contrast.matrix) 
  ##è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œçœ‹çœ‹æ•ˆæœ
  
  fit2 <- eBayes(fit2)  ## default no trend !!!
  ##eBayes() with trend=TRUE
  ##step3
  tempOutput = topTable(fit2, coef=1, n=Inf)
  nrDEG = na.omit(tempOutput) 
  #write.csv(nrDEG2,"limma_notrend.results.csv",quote = F)
  head(nrDEG)
  return(nrDEG)
}
```

å·®å¼‚åˆ†æç»“æœï¼š

```R
DEGs <- deg(expmat,design,contrast.matrix)
```

## å…ˆå½’ä¸€åŒ–è¡¨è¾¾çŸ©é˜µï¼Œå†åšå·®å¼‚åˆ†æ

```R
NM_expmat <- t(scale(t(expmat)))
```

```R
NMdesign <- model.matrix(~0+factor(group_list))
colnames(NMdesign) <- levels(factor(group_list))
rownames(NMdesign) <- colnames(NM_expmat)
NMcontrast.matrix<-makeContrasts("npc-normal",levels = NMdesign)
NMcontrast.matrix
#         Contrasts
# Levels   npc-normal
#   normal         -1
#   npc             1
## å…¶å®è®¾è®¡çŸ©é˜µã€æ¯”è¾ƒçŸ©é˜µå’Œå‰é¢çš„æ˜¯ä¸€æ ·çš„
```

å·®å¼‚åˆ†æç»“æœï¼š

```R
NM_DEGs <- deg(NM_expmat,NMdesign,NMcontrast.matrix)
```

## æ¯”è¾ƒä¸¤ä¸ªFC

#### ç”»å›¾

```R
common_FC <- DEGs$logFC
weird_FC <- NM_DEGs$logFC
plot(common_FC , weird_FC)
```

![](https://upload-images.jianshu.io/upload_images/14383117-e17e16d5452a7593.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![](https://upload-images.jianshu.io/upload_images/14383117-1c729d7565af6a4a.gif_jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å†·é™ä¸€ä¸‹ï¼Œè¿™**ä¸**æ˜¯æŸ“è‰²ä½“ã€‚

æ‰€ä»¥è¿™æ„å‘³ç€ï¼Œä¸€äº›logFCå€¼çš„**æ­£è´Ÿ**åè¿‡æ¥äº†ï¼Œæ„å‘³ç€ï¼Œä¸Šè°ƒä¸‹è°ƒ**å**è¿‡æ¥äº†ã€‚

![](https://upload-images.jianshu.io/upload_images/14383117-d7db86025eb0da94.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### æ£€éªŒæ­£è´Ÿå˜åŒ–

```R
table(common_FC > 0)
# FALSE  TRUE 
# 24849 19300 

table(weird_FC > 0)
# FALSE  TRUE 
# 24849 19300 
```

ç¥å¥‡çš„æ˜¯ï¼Œä¸¤ä¸ªFCä¸­æ­£è´Ÿå€¼çš„æ•°é‡æ˜¯ä¸€æ ·çš„ï¼Œéš¾é“æ²¡å˜å—ï¼Ÿ

å†ç”¨è´Ÿè´Ÿå¾—æ­£æ£€éªŒä¸€ä¸‹

```R
test <- (common_FC * weird_FC)
table(test > 0)
# FALSE  TRUE 
# 21382 22767 
```

emmmmè¿™è¯´æ˜æœ‰**21382**ä¸ªFCå€¼çš„æ­£è´Ÿå˜äº†....å—?

**å†**ç¡®è®¤ä¸€ä¸‹ï¼š

![](https://upload-images.jianshu.io/upload_images/14383117-2e67b3fec8c41764.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ç›´æ¥ç”»å›¾ï¼Œä¹˜é™¤æ²¡é—®é¢˜ã€‚ä½†ï¼Œé—®é¢˜å°±æ˜¯ï¼Œé¡ºåºå±…ç„¶æ˜¯**ä¸€è‡´çš„ï¼Ÿ**

**å†**æ£€æŸ¥ä¸€ä¸‹ï¼š

```R
table(row.names(DEGs)==row.names(NM_DEGs))
# FALSE  TRUE 
# 43984   165 
```

**NEVER BELIEVE WHAT YOU SEE**  ~~- by é²è¿…~~

é‡æ–°æ’åºåï¼š

```R
order1 <- row.names(DEGs)
odNM_DEGs <- NM_DEGs[order1,]
table(row.names(DEGs)==row.names(odNM_DEGs))
#  TRUE 
# 44149 
fntest <- (DEGs$logFC * odNM_DEGs$logFC)
table(fntest > 0)
# TRUE 
# 44149 
```

æ‰€ä»¥å¹¶æ²¡æœ‰æ­£è´Ÿå˜æ¢ã€ä¸Šè°ƒä¸‹è°ƒå˜æ¢è¿™ä¹ˆææ€–çš„äº‹....

## æ‰‹åŠ¨æ ¹æ®å…¬å¼ç®—FC

$log2FoldChange = log2(Sample1/Sample2) $

â€‹                             $ = log2(Sample1) - log2(Sample2)$

```R
mean_210297_s_at <- mean(expmat[,design[,2]==1]['210297_s_at',])
ckmean_210297_s_at <- mean(expmat[,design[,2]==0]['210297_s_at',])
comFC_210297_s_at <- mean_210297_s_at - ckmean_210297_s_at
comFC_210297_s_at
# [1] -3.566486
DEGs["210297_s_at",1]
# [1] -3.566486
```

```R
mean_210297_s_at <- mean(NM_expmat[,design[,2]==1]['210297_s_at',])
ckmean_210297_s_at <- mean(NM_expmat[,design[,2]==0]['210297_s_at',])
wrdFC_210297_s_at <- mean_210297_s_at - ckmean_210297_s_at
wrdFC_210297_s_at
# [1] -1.36838
odNM_DEGs["210297_s_at",1]
# [1] -1.36838
```

éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚

## ç”»å›¾

```R
common_FC <- DEGs$logFC
odered_NMFC <- odNM_DEGs$logFC
plot(common_FC , odered_NMFC)
```

![](https://upload-images.jianshu.io/upload_images/14383117-c655f7d5630d79c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ‰€ä»¥æ­£ç¡®çš„åº”è¯¥æ˜¯æŸ“è‰²è´¨ã€‚ï¼ˆé›¾

```r
plot(abs(correctFC), abs(odered_NMFC))
```

![](https://upload-images.jianshu.io/upload_images/14383117-0586865834bdc2ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç»å½’ä¸€åŒ–çš„è¡¨è¾¾çŸ©é˜µåšå·®å¼‚åˆ†æï¼Œå¾—åˆ°çš„FCå¤§æ¦‚ä¼šè½åœ¨ $\int _0^4\left(2+2x-\frac{1}{2}x\right)dx$ é‡Œï¼ŒåŸå§‹çŸ©é˜µä¸åŒå½’ä¸€åŒ–çŸ©é˜µä¸åŒï¼Œä¸€é¡¿æ“ä½œå¾—åˆ°çš„ä¸¤ä¸ªFCå’Œå®ƒä»¬ä¹‹é—´å…³ç³»è‚¯å®šä¹Ÿä¸åŒï¼Œso,å¤§æ¦‚ä¹Ÿå¹¶ä¸æ˜¯å¾ˆæ™®é€‚(ï¼ _ï¼ ;)

```R
plot(abs(correctFC), abs(correctFC)/abs(odered_NMFC))
```

![](https://upload-images.jianshu.io/upload_images/14383117-5cd13101290eff16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

```r
plot(common_FC, common_FC/odered_NMFC)
```

![](https://upload-images.jianshu.io/upload_images/14383117-913add4bec7dd341.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



ç›®å‰çœ‹èµ·æ¥ï¼Œä»¥GSE12452ä¸ºä¾‹ï¼Œè¡¨è¾¾çŸ©é˜µè¢«å½’ä¸€åŒ–åå†åšå·®å¼‚åˆ†æï¼ŒFCé˜ˆå€¼ç¼©ä¸ºåŸæ¥çš„ä¸€åŠï¼Œç»å¤§éƒ¨åˆ†FC~0~æ˜¯FCçš„1.25å€ï¼Œæå°‘æ•°åœ¨3å€ä»¥ä¸Šï¼ŒFC~0~å’ŒFC~0~/FCçš„å…³ç³»åœ¨0.5xä»¥ä¸Šã€‚

---
# æœ€åï¼Œå‘å¤§å®¶éš†é‡æ¨èç”Ÿä¿¡æŠ€èƒ½æ ‘çš„ä¸€ç³»åˆ—å¹²è´§ï¼

1.  ç”Ÿä¿¡æŠ€èƒ½æ ‘å…¨çƒå…¬ç›Šå·¡è®²ï¼š[https://mp.weixin.qq.com/s/E9ykuIbc-2Ja9HOY0bn_6g](https://links.jianshu.com/go?to=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FE9ykuIbc-2Ja9HOY0bn_6g)
2.  Bç«™å…¬ç›Š74å°æ—¶ç”Ÿä¿¡å·¥ç¨‹å¸ˆæ•™å­¦è§†é¢‘åˆè¾‘ï¼š[https://mp.weixin.qq.com/s/IyFK7l_WBAiUgqQi8O7Hxw](https://links.jianshu.com/go?to=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FIyFK7l_WBAiUgqQi8O7Hxw)
3.  æ‹›å­¦å¾’ï¼š[https://mp.weixin.qq.com/s/KgbilzXnFjbKKunuw7NVfw](https://links.jianshu.com/go?to=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKgbilzXnFjbKKunuw7NVfw)

